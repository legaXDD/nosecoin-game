import React, { useState, useEffect, useCallback, useRef } from 'react';import { ShoppingCart, Zap, Clock, TrendingUp, Award, Gift, Users, Settings } from 'lucide-react';const NoseCoinClicker = () => {  const [coins, setCoins] = useState(0);  const [gems, setGems] = useState(0);  const [clickPower, setClickPower] = useState(1);  const [autoClickers, setAutoClickers] = useState(0);  const [multiplier, setMultiplier] = useState(1);  const [activeTab, setActiveTab] = useState('game');  const [clickAnimations, setClickAnimations] = useState([]);  const [particles, setParticles] = useState([]);  const [coinScale, setCoinScale] = useState(1);  const [totalClicks, setTotalClicks] = useState(0);  const [achievements, setAchievements] = useState([]);  const [totalCoinsEarned, setTotalCoinsEarned] = useState(0);  const [selectedNose, setSelectedNose] = useState('??');  const [unlockedNoses, setUnlockedNoses] = useState(['??']);  const [activeBoosters, setActiveBoosters] = useState([]);  const [availableBoosters, setAvailableBoosters] = useState([]); // Купленные, но не активированные бустеры  const [lastSpinTime, setLastSpinTime] = useState(0);  const [critChance, setCritChance] = useState(5);  const [showRouletteModal, setShowRouletteModal] = useState(false);  const [rouletteSpinning, setRouletteSpinning] = useState(false);  const [rouletteResult, setRouletteResult] = useState('');  const [showLeaderboard, setShowLeaderboard] = useState(false);  const [playerProfile, setPlayerProfile] = useState({    username: '@player_you',    first_name: 'Игрок',    photo_url: '??'  });    // Защита от автокликеров  const lastClickTimes = useRef([]);  const suspiciousActivity = useRef(0);  const [isBlocked, setIsBlocked] = useState(false);  const [blockTimeLeft, setBlockTimeLeft] = useState(0);  // Функция склонения  const declension = (number, one, two, five) => {    const n = Math.abs(number);    const n10 = n % 10;    const n100 = n % 100;        if (n100 >= 11 && n100 <= 19) {      return five;    }    if (n10 === 1) {      return one;    }    if (n10 >= 2 && n10 <= 4) {      return two;    }    return five;  };  // Инициализация Telegram Web App  useEffect(() => {    if (window.Telegram?.WebApp) {      const tg = window.Telegram.WebApp;      tg.ready();            if (tg.initDataUnsafe?.user) {        const user = tg.initDataUnsafe.user;        setPlayerProfile({          username: user.username ? `@${user.username}` : `${user.first_name}`,          first_name: user.first_name || 'Игрок',          photo_url: user.photo_url || '??'        });      }            tg.setHeaderColor('#1f2937');      tg.setBackgroundColor('#111827');    }  }, []);  // Коллекция носов (теперь с разноцветными монетами)  const noseCollection = [    { id: '??', name: 'Классический', rarity: 'common', bonus: 0, cost: 0, unlocked: true, coinColor: 'from-yellow-400 via-yellow-500 to-yellow-600' },    { id: '??', name: 'Оранжевая', rarity: 'common', bonus: 0.1, cost: 1000, unlocked: false, coinColor: 'from-orange-400 via-orange-500 to-orange-600' },    { id: '??', name: 'Красная', rarity: 'rare', bonus: 0.25, cost: 5000, unlocked: false, coinColor: 'from-red-400 via-red-500 to-red-600' },    { id: '??', name: 'Зеленая', rarity: 'rare', bonus: 0.5, cost: 15000, unlocked: false, coinColor: 'from-green-400 via-green-500 to-green-600' },    { id: '??', name: 'Синяя', rarity: 'epic', bonus: 1, cost: 50000, unlocked: false, coinColor: 'from-blue-400 via-blue-500 to-blue-600' },    { id: '??', name: 'Фиолетовая', rarity: 'epic', bonus: 1.5, cost: 150000, unlocked: false, coinColor: 'from-purple-400 via-purple-500 to-purple-600' },    { id: '?', name: 'Черная', rarity: 'legendary', bonus: 2, cost: 500000, unlocked: false, coinColor: 'from-gray-700 via-gray-800 to-gray-900' },    { id: '??', name: 'Алмазная', rarity: 'legendary', bonus: 3, cost: 2000000, unlocked: false, coinColor: 'from-cyan-400 via-blue-500 to-purple-600' }  ];  // Временные бустеры с динамическими ценами  const getBoosters = () => {    const baseMultiplier = Math.floor(totalCoinsEarned / 100000) + 1; // Цена растет каждые 100k заработанных монет        return [      {         id: 'double_click',         name: 'Двойной клик',         effect: 2,         duration: 15,         cost: Math.floor(500 * Math.pow(1.5, baseMultiplier)),         icon: '?'       },      {         id: 'mega_mult',         name: 'Тройной множитель',         effect: 3,         duration: 15,         cost: Math.floor(2000 * Math.pow(1.8, baseMultiplier)),         icon: '??'       },      {         id: 'auto_boost',         name: 'Авто бустер',         effect: 5,         duration: 20,         cost: Math.floor(1500 * Math.pow(1.6, baseMultiplier)),         icon: '??'       },      {         id: 'crit_boost',         name: 'Критический бустер',         effect: 10, // Снижен с 50 до 10        duration: 12,         cost: Math.floor(5000 * Math.pow(2, baseMultiplier)),         icon: '??'       }    ];  };  // Сбалансированный магазин гемов  const gemShop = [    {       id: 'small_coins',       name: 'Мешок монет',       description: 'Получить 10,000 монет',       cost: 5,       icon: '??',       effect: () => setCoins(prev => prev + 10000)     },    {       id: 'medium_coins',       name: 'Сундук монет',       description: 'Получить 50,000 монет',       cost: 20,       icon: '??',       effect: () => setCoins(prev => prev + 50000)     },    {       id: 'small_crit',       name: 'Удача',       description: 'Увеличить шанс крита на 3%',       cost: 15,       icon: '??',       effect: () => setCritChance(prev => prev + 3)     },    {       id: 'power_boost',       name: 'Сила пальца',       description: 'Увеличить силу клика на 10',       cost: 25,       icon: '??',       effect: () => setClickPower(prev => prev + 10)     },    {       id: 'auto_pack',       name: 'Пакет роботов',       description: 'Получить 5 автокликеров',       cost: 40,       icon: '??',       effect: () => setAutoClickers(prev => prev + 5)     },    {       id: 'rare_nose',       name: 'Редкий нос',       description: 'Разблокировать случайный редкий нос',       cost: 60,       icon: '??',       effect: () => {        const rareNoses = ['??', '??', '??'];        const availableNoses = rareNoses.filter(nose => !unlockedNoses.includes(nose));        if (availableNoses.length > 0) {          const randomNose = availableNoses[Math.floor(Math.random() * availableNoses.length)];          setUnlockedNoses(prev => [...prev, randomNose]);        }      }    }  ];  // Рулетка призов  const roulettePrizes = [    { name: 'Монеты', value: '2000', type: 'coins', chance: 35, color: 'text-yellow-400' },    { name: 'Много монет', value: '8000', type: 'coins', chance: 20, color: 'text-yellow-500' },    { name: 'Гемы', value: '3', type: 'gems', chance: 25, color: 'text-purple-400' },    { name: 'Бустер клика', value: 'double_click', type: 'booster', chance: 15, color: 'text-blue-400' },    { name: 'Авто бустер', value: 'auto_boost', type: 'booster', chance: 5, color: 'text-green-400' }  ];  // Загрузка реальных игроков с сервера  const [leaderboardData, setLeaderboardData] = useState([]);    useEffect(() => {    const mockPlayers = [      { id: 1, username: '@noseking2024', first_name: 'Король', photo_url: '??', score: 2500000 },      { id: 2, username: '@megaclicker', first_name: 'МегаКликер', photo_url: '??', score: 1800000 },      { id: 3, username: '@nosehunter', first_name: 'Охотник', photo_url: '??', score: 1200000 },      { id: 4, username: '@clickmaster', first_name: 'Мастер', photo_url: '?', score: 950000 },      { id: 5, username: '@goldennose', first_name: 'Золотой', photo_url: '??', score: 750000 },      {         id: 'player',         username: playerProfile.username,         first_name: playerProfile.first_name,         photo_url: playerProfile.photo_url,         score: Math.floor(totalCoinsEarned),         isPlayer: true       }    ];    setLeaderboardData(mockPlayers.sort((a, b) => b.score - a.score));  }, [totalCoinsEarned, playerProfile]);  const [gameStats, setGameStats] = useState({    totalSpent: 0,    passiveEarned: 0,    playTime: 0,    fastClicks: 0,    superFastClicks: 0,    exactCoins: 0,    criticalHits: 0,    spinsUsed: 0,    boostersUsed: 0  });  // Расширенный список достижений с наградами  const achievementsList = [    { id: 'first_click', name: 'Первый нюх', desc: 'Сделать первый клик', threshold: 1, key: 'totalClicks', icon: '??', reward: { gems: 1 } },    { id: 'ten_clicks', name: 'Начинающий нюхач', desc: 'Сделать 10 кликов', threshold: 10, key: 'totalClicks', icon: '??', reward: { gems: 1 } },    { id: 'hundred_clicks', name: 'Сотня нюхов', desc: 'Сделать 100 кликов', threshold: 100, key: 'totalClicks', icon: '??', reward: { gems: 2, nose: '??' } },    { id: 'thousand_clicks', name: 'Мастер носа', desc: 'Сделать 1000 кликов', threshold: 1000, key: 'totalClicks', icon: '??', reward: { gems: 3 } },    { id: 'ten_thousand_clicks', name: 'Легенда носа', desc: 'Сделать 10,000 кликов', threshold: 10000, key: 'totalClicks', icon: '??', reward: { gems: 5, nose: '??' } },        { id: 'hundred_coins', name: 'Первые деньги', desc: 'Накопить 100 монет', threshold: 100, key: 'coins', icon: '??', reward: { gems: 1 } },    { id: 'thousand_coins', name: 'Богач носов', desc: 'Накопить 1,000 монет', threshold: 1000, key: 'coins', icon: '??', reward: { gems: 2 } },    { id: 'ten_thousand_coins', name: 'Носовой миллионер', desc: 'Накопить 10,000 монет', threshold: 10000, key: 'coins', icon: '??', reward: { gems: 3, nose: '??' } },    { id: 'hundred_thousand_coins', name: 'Король носов', desc: 'Накопить 100,000 монет', threshold: 100000, key: 'coins', icon: '??', reward: { gems: 5, nose: '??' } },    { id: 'million_coins', name: 'Носовой магнат', desc: 'Накопить 1,000,000 монет', threshold: 1000000, key: 'coins', icon: '??', reward: { gems: 10, nose: '??' } },        { id: 'first_crit', name: 'Первый крит', desc: 'Сделать критический удар', threshold: 1, key: 'criticalHits', icon: '??', reward: { gems: 1 } },    { id: 'hundred_crits', name: 'Критический мастер', desc: 'Сделать 100 критов', threshold: 100, key: 'criticalHits', icon: '??', reward: { gems: 5 } },        { id: 'first_upgrade', name: 'Первое улучшение', desc: 'Купить любое улучшение', threshold: 1, key: 'upgrades', icon: '??', reward: { gems: 1 } },    { id: 'five_upgrades', name: 'Коллекционер', desc: 'Купить 5 улучшений', threshold: 5, key: 'upgrades', icon: '??', reward: { gems: 2 } },    { id: 'twenty_upgrades', name: 'Инвестор', desc: 'Купить 20 улучшений', threshold: 20, key: 'upgrades', icon: '??', reward: { gems: 5 } },        { id: 'nose_collector', name: 'Коллекционер носов', desc: 'Разблокировать 3 носа', threshold: 3, key: 'nosesUnlocked', icon: '??', reward: { gems: 3 } },    { id: 'nose_master', name: 'Мастер носов', desc: 'Разблокировать все носы', threshold: 8, key: 'nosesUnlocked', icon: '??', reward: { gems: 15, nose: '??' } },        { id: 'daily_spinner', name: 'Везунчик', desc: 'Покрутить рулетку первый раз', threshold: 1, key: 'spinsUsed', icon: '??', reward: { gems: 2 } },    { id: 'booster_user', name: 'Любитель бустеров', desc: 'Использовать 10 бустеров', threshold: 10, key: 'boostersUsed', icon: '?', reward: { gems: 5 } }  ];  // Сбалансированный магазин улучшений  const upgrades = [    {      id: 'click_power',      name: 'Мощный палец',      description: 'Увеличивает силу клика на 1',      baseCost: 15,      multiplier: 1.15,      currentLevel: clickPower - 1,      icon: '??',      effect: () => setClickPower(prev => prev + 1)    },    {      id: 'auto_clicker',      name: 'Авто-нюхач',      description: 'Автоматически кликает каждую секунду',      baseCost: 100,      multiplier: 1.15,      currentLevel: autoClickers,      icon: '??',      effect: () => setAutoClickers(prev => prev + 1)    },    {      id: 'multiplier',      name: 'Носовой бустер',      description: 'Увеличивает множитель на 0.1x',      baseCost: 1000,      multiplier: 1.25,      currentLevel: Math.floor((multiplier - 1) * 10),      icon: '??',      effect: () => setMultiplier(prev => prev + 0.1)    },    {      id: 'crit_chance',      name: 'Критический шанс',      description: 'Увеличивает шанс крита на 1%',      baseCost: 500,      multiplier: 1.2,      currentLevel: critChance - 5,      icon: '??',      effect: () => setCritChance(prev => prev + 1)    }  ];  // Проверка на автокликер  const checkForAutoClicker = () => {    const now = Date.now();    lastClickTimes.current.push(now);        if (lastClickTimes.current.length > 10) {      lastClickTimes.current.shift();    }        if (lastClickTimes.current.length >= 5) {      const recentClicks = lastClickTimes.current.slice(-5);      const intervals = [];            for (let i = 1; i < recentClicks.length; i++) {        intervals.push(recentClicks[i] - recentClicks[i-1]);      }            const avgInterval = intervals.reduce((a, b) => a + b) / intervals.length;      const maxDeviation = Math.max(...intervals) - Math.min(...intervals);            if (avgInterval < 50 && maxDeviation < 10) {        suspiciousActivity.current++;                if (suspiciousActivity.current >= 3) {          setIsBlocked(true);          setBlockTimeLeft(30);          suspiciousActivity.current = 0;          return true;        }      } else {        suspiciousActivity.current = Math.max(0, suspiciousActivity.current - 0.5);      }    }        return false;  };  // Таймер блокировки  useEffect(() => {    if (blockTimeLeft > 0) {      const timer = setTimeout(() => {        setBlockTimeLeft(prev => {          if (prev <= 1) {            setIsBlocked(false);            return 0;          }          return prev - 1;        });      }, 1000);      return () => clearTimeout(timer);    }  }, [blockTimeLeft]);  // Активные бустеры  useEffect(() => {    const interval = setInterval(() => {      setActiveBoosters(prev =>         prev.map(booster => ({          ...booster,          timeLeft: Math.max(0, booster.timeLeft - 1)        })).filter(booster => booster.timeLeft > 0)      );    }, 1000);        return () => clearInterval(interval);  }, []);  // Рулетка удачи  const canSpin = () => {    const now = Date.now();    const oneDayMs = 24 * 60 * 60 * 1000;    return now - lastSpinTime >= oneDayMs;  };  const getTimeUntilNextSpin = () => {    const now = Date.now();    const oneDayMs = 24 * 60 * 60 * 1000;    const timePassed = now - lastSpinTime;    const timeLeft = oneDayMs - timePassed;        if (timeLeft <= 0) return null;        const hours = Math.floor(timeLeft / (60 * 60 * 1000));    const minutes = Math.floor((timeLeft % (60 * 60 * 1000)) / (60 * 1000));        return `${hours}ч ${minutes}м`;  };  const spinRoulette = () => {    if (!canSpin() || rouletteSpinning) return;        setRouletteSpinning(true);        setTimeout(() => {      const random = Math.random() * 100;      let cumulative = 0;      let selectedPrize = null;            for (const prize of roulettePrizes) {        cumulative += prize.chance;        if (random <= cumulative) {          selectedPrize = prize;          break;        }      }            // Выдача награды      if (selectedPrize.type === 'coins') {        setCoins(prev => prev + parseInt(selectedPrize.value));      } else if (selectedPrize.type === 'gems') {        setGems(prev => prev + parseInt(selectedPrize.value));      } else if (selectedPrize.type === 'booster') {        addAvailableBooster(selectedPrize.value);      }            setRouletteResult(`Выиграно: ${selectedPrize.name}!`);      setLastSpinTime(Date.now());      setRouletteSpinning(false);            setGameStats(prev => ({        ...prev,        spinsUsed: (prev.spinsUsed || 0) + 1      }));    }, 2000);  };  // Добавление доступного бустера  const addAvailableBooster = (boosterId) => {    const booster = getBoosters().find(b => b.id === boosterId);    if (!booster) return;        setAvailableBoosters(prev => [      ...prev,      { ...booster, id: `${boosterId}_${Date.now()}` }    ]);  };  // Активация бустера  const activateBooster = (availableBoosterId) => {    const availableBooster = availableBoosters.find(b => b.id === availableBoosterId);    if (!availableBooster) return;        // Удаляем из доступных    setAvailableBoosters(prev => prev.filter(b => b.id !== availableBoosterId));        // Добавляем в активные    setActiveBoosters(prev => [      ...prev.filter(b => b.originalId !== availableBooster.id),      { ...availableBooster, timeLeft: availableBooster.duration, originalId: availableBooster.id }    ]);        setGameStats(prev => ({      ...prev,      boostersUsed: (prev.boostersUsed || 0) + 1    }));  };  const buyBooster = (boosterId) => {    const booster = getBoosters().find(b => b.id === boosterId);    if (coins >= booster.cost) {      setCoins(prev => prev - booster.cost);      addAvailableBooster(boosterId);    }  };  // Покупка в магазине гемов  const buyGemItem = (itemId) => {    const item = gemShop.find(i => i.id === itemId);    if (gems >= item.cost) {      setGems(prev => prev - item.cost);      item.effect();    }  };  // Покупка носа  const buyNose = (noseId) => {    const nose = noseCollection.find(n => n.id === noseId);    if (coins >= nose.cost && !unlockedNoses.includes(noseId)) {      setCoins(prev => prev - nose.cost);      setUnlockedNoses(prev => [...prev, noseId]);    }  };  // Создание частиц  const createParticles = (x, y, isCrit = false) => {    const particleCount = isCrit ? 12 : 8;    const newParticles = [];        for (let i = 0; i < particleCount; i++) {      const angle = (Math.PI * 2 * i) / particleCount;      const velocity = isCrit ? 4 + Math.random() * 4 : 2 + Math.random() * 3;      const particle = {        id: Date.now() + i,        x: x,        y: y,        vx: Math.cos(angle) * velocity,        vy: Math.sin(angle) * velocity,        life: 1,        decay: 0.02,        color: isCrit ? ['??', '??', '?', '?'] : ['??', '?', '?', '??', '??'],        isCrit      };      particle.color = particle.color[Math.floor(Math.random() * particle.color.length)];      newParticles.push(particle);    }        setParticles(prev => [...prev, ...newParticles]);  };  // Анимация частиц  useEffect(() => {    const interval = setInterval(() => {      setParticles(prev =>         prev.map(particle => ({          ...particle,          x: particle.x + particle.vx,          y: particle.y + particle.vy,          life: particle.life - particle.decay,          vy: particle.vy + 0.1        })).filter(particle => particle.life > 0)      );    }, 16);        return () => clearInterval(interval);  }, []);  // Автоматические клики  useEffect(() => {    if (autoClickers > 0) {      const interval = setInterval(() => {        const autoBooster = activeBoosters.find(b => b.originalId === 'auto_boost');        const autoMultiplier = autoBooster ? autoBooster.effect : 1;        const earned = autoClickers * multiplier * autoMultiplier;        setCoins(prev => prev + earned);        setGameStats(prev => ({          ...prev,          passiveEarned: prev.passiveEarned + earned        }));      }, 1000);      return () => clearInterval(interval);    }  }, [autoClickers, multiplier, activeBoosters]);  // Проверка достижений  useEffect(() => {    const stats = {      totalClicks,      coins,      upgrades: clickPower - 1 + autoClickers + Math.floor((multiplier - 1) * 10),      autoClickers,      multiplier,      clickPower,      exactCoins: coins,      nosesUnlocked: unlockedNoses.length,      ...gameStats    };    achievementsList.forEach(achievement => {      if (!achievements.includes(achievement.id) && stats[achievement.key] >= achievement.threshold) {        setAchievements(prev => [...prev, achievement.id]);                if (achievement.reward.gems) {          setGems(prev => prev + achievement.reward.gems);        }        if (achievement.reward.nose && !unlockedNoses.includes(achievement.reward.nose)) {          setUnlockedNoses(prev => [...prev, achievement.reward.nose]);        }                showNotification(`?? ${achievement.name} (+${achievement.reward.gems || 0} ${declension(achievement.reward.gems || 0, 'гем', 'гема', 'гемов')})`);      }    });  }, [totalClicks, coins, clickPower, autoClickers, multiplier, achievements, gameStats, unlockedNoses]);  const showNotification = (text) => {    console.log(text);  };  // Анимация клика  const createClickAnimation = (x, y, value, isCrit = false) => {    const id = Date.now() + Math.random();    const animation = {      id,      x: x - 50,      y: y - 50,      value,      isCrit    };        setClickAnimations(prev => [...prev, animation]);        setTimeout(() => {      setClickAnimations(prev => prev.filter(anim => anim.id !== id));    }, 1000);  };  // Обработка клика по носу  const handleCoinClick = useCallback((e) => {    if (isBlocked || checkForAutoClicker()) return;        const rect = e.currentTarget.getBoundingClientRect();    const x = e.clientX - rect.left;    const y = e.clientY - rect.top;        const isCrit = Math.random() * 100 < critChance;        const clickBooster = activeBoosters.find(b => b.originalId === 'double_click');    const multBooster = activeBoosters.find(b => b.originalId === 'mega_mult');    const critBooster = activeBoosters.find(b => b.originalId === 'crit_boost');        let damage = clickPower * multiplier;    if (clickBooster) damage *= clickBooster.effect;    if (multBooster) damage *= multBooster.effect;    if (isCrit) {      const critMultiplier = critBooster ? critBooster.effect : 2;      damage *= critMultiplier;      setGameStats(prev => ({        ...prev,        criticalHits: prev.criticalHits + 1      }));    }        const currentNose = noseCollection.find(n => n.id === selectedNose);    if (currentNose) {      damage *= (1 + currentNose.bonus);    }        const earnedCoins = Math.floor(damage);    setCoins(prev => prev + earnedCoins);    setTotalClicks(prev => prev + 1);    setTotalCoinsEarned(prev => prev + earnedCoins);        createClickAnimation(x, y, earnedCoins, isCrit);    createParticles(x, y, isCrit);        setCoinScale(isCrit ? 1.25 : 1.15);    setTimeout(() => setCoinScale(1), 150);  }, [clickPower, multiplier, activeBoosters, critChance, selectedNose, isBlocked]);  // Покупка улучшения  const buyUpgrade = (upgrade) => {    const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.multiplier, upgrade.currentLevel));    if (coins >= cost) {      setCoins(prev => prev - cost);      setGameStats(prev => ({        ...prev,        totalSpent: prev.totalSpent + cost      }));      upgrade.effect();    }  };  const getUpgradeCost = (upgrade) => {    return Math.floor(upgrade.baseCost * Math.pow(upgrade.multiplier, upgrade.currentLevel));  };  // Получаем текущий цвет монеты  const getCurrentCoinColor = () => {    const currentNose = noseCollection.find(n => n.id === selectedNose);    return currentNose?.coinColor || 'from-yellow-400 via-yellow-500 to-yellow-600';  };  return (    <div className="min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black text-white overflow-hidden flex flex-col">      {/* Блокировка автокликеров */}      {isBlocked && (        <div className="fixed inset-0 bg-red-900/80 backdrop-blur-sm z-50 flex items-center justify-center">          <div className="bg-gray-800 p-8 rounded-xl border border-red-500 text-center">            <div className="text-6xl mb-4">??</div>            <h2 className="text-2xl font-bold text-red-400 mb-2">Подозрительная активность!</h2>            <p className="text-gray-300 mb-4">Обнаружено использование автокликера</p>            <p className="text-xl font-bold text-white">              Разблокировка через: {blockTimeLeft} {declension(blockTimeLeft, 'секунда', 'секунды', 'секунд')}            </p>          </div>        </div>      )}      {/* Модалка рулетки */}      {showRouletteModal && (        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-40 flex items-center justify-center p-4">          <div className="bg-gradient-to-br from-gray-800 to-gray-900 p-8 rounded-xl border border-gray-600 max-w-md w-full">            <h2 className="text-2xl font-bold text-center text-yellow-400 mb-6">?? Рулетка удачи</h2>                        {!canSpin() && !rouletteSpinning && (              <div className="text-center">                <p className="text-gray-400 mb-4">Следующая попытка через:</p>                <p className="text-xl font-bold text-red-400">                  {getTimeUntilNextSpin()}                </p>              </div>            )}                        {canSpin() && !rouletteSpinning && (              <div className="text-center">                <div className="grid grid-cols-1 gap-2 mb-6">                  {roulettePrizes.map((prize, idx) => (                    <div key={idx} className={`${prize.color} text-sm`}>                      {prize.name} ({prize.chance}%)                    </div>                  ))}                </div>                <button                  onClick={spinRoulette}                  className="w-full bg-gradient-to-r from-yellow-600 to-yellow-500 text-black font-bold py-3 px-6 rounded-lg hover:from-yellow-500 hover:to-yellow-400 transition-all"                >                  ?? Крутить рулетку!                </button>              </div>            )}                        {rouletteSpinning && (              <div className="text-center">                <div className="text-6xl animate-spin mb-4">??</div>                <p className="text-yellow-400">Крутится...</p>              </div>            )}                        {rouletteResult && !rouletteSpinning && (              <div className="text-center">                <div className="text-4xl mb-4">??</div>                <p className="text-green-400 font-bold text-lg">{rouletteResult}</p>              </div>            )}                        <button              onClick={() => {                setShowRouletteModal(false);                setRouletteResult('');              }}              className="w-full mt-4 bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition-all"            >              Закрыть            </button>          </div>        </div>      )}      {/* Модалка лидерборда */}      {showLeaderboard && (        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-40 flex items-center justify-center p-4">          <div className="bg-gradient-to-br from-gray-800 to-gray-900 p-6 rounded-xl border border-gray-600 max-w-md w-full max-h-96 overflow-y-auto">            <h2 className="text-2xl font-bold text-center text-yellow-400 mb-6">?? Рейтинг игроков</h2>                        <div className="space-y-3">              {leaderboardData.map((player, idx) => (                <div                   key={player.id}                   className={`flex items-center justify-between p-3 rounded-lg ${                    player.isPlayer                       ? 'bg-yellow-900/30 border border-yellow-600'                       : 'bg-gray-700/50'                  }`}                >                  <div className="flex items-center space-x-3">                    <div className="text-lg font-bold text-gray-400">#{idx + 1}</div>                    <div className="text-xl">{player.photo_url}</div>                    <div>                      <div className={`font-semibold ${player.isPlayer ? 'text-yellow-400' : 'text-white'}`}>                        {player.username}                      </div>                      <div className="text-sm text-gray-400">                        {player.score.toLocaleString()} {declension(player.score, 'монета', 'монеты', 'монет')}                      </div>                    </div>                  </div>                  {idx < 3 && (                    <div className="text-xl">                      {idx === 0 ? '??' : idx === 1 ? '??' : '??'}                    </div>                  )}                </div>              ))}            </div>                        <button              onClick={() => setShowLeaderboard(false)}              className="w-full mt-4 bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition-all"            >              Закрыть            </button>          </div>        </div>      )}      {/* Заголовок */}      <div className="text-center py-4 bg-gradient-to-r from-gray-800 to-gray-900 shadow-2xl border-b border-gray-700">        <h1 className="text-2xl font-bold text-yellow-400 mb-1">?? NoseCoin</h1>        <div className="flex justify-center items-center space-x-4 mb-2">          <div className="text-xl font-semibold text-white">            {Math.floor(coins).toLocaleString()} {declension(Math.floor(coins), 'монета', 'монеты', 'монет')}          </div>          <div className="text-sm text-purple-400">            ??{gems} {declension(gems, 'гем', 'гема', 'гемов')}          </div>        </div>        <div className="text-xs text-gray-300">          Клик: {Math.floor(clickPower * multiplier * (1 + (noseCollection.find(n => n.id === selectedNose)?.bonus || 0))).toLocaleString()} |           Авто: {(autoClickers * multiplier).toLocaleString()}/сек |           Крит: {critChance}%        </div>                {/* Активные бустеры */}        {activeBoosters.length > 0 && (          <div className="flex justify-center space-x-2 mt-2">            {activeBoosters.map(booster => (              <div key={booster.id} className="bg-green-600/20 border border-green-500 rounded px-2 py-1 text-xs">                {booster.icon} {booster.timeLeft}с              </div>            ))}          </div>        )}      </div>      {/* Игровая область */}      {activeTab === 'game' && (        <div className="flex-1 flex flex-col items-center justify-center p-6 relative min-h-0">          {/* Частицы */}          {particles.map(particle => (            <div              key={particle.id}              className={`absolute pointer-events-none text-2xl z-10 ${particle.isCrit ? 'animate-bounce' : ''}`}              style={{                left: particle.x,                top: particle.y,                opacity: particle.life,                transform: `scale(${particle.life * (particle.isCrit ? 1.5 : 1)})`              }}            >              {particle.color}            </div>          ))}                    {/* Анимации кликов */}          {clickAnimations.map(anim => (            <div              key={anim.id}              className={`absolute pointer-events-none font-bold text-2xl z-20 ${                anim.isCrit ? 'text-red-400 animate-pulse' : 'text-yellow-400'              }`}              style={{                left: anim.x,                top: anim.y,                animation: 'float-up 1s ease-out forwards',                fontSize: anim.isCrit ? '2rem' : '1.5rem'              }}            >              {anim.isCrit ? 'КРИТ!' : '+'}{anim.value.toLocaleString()}            </div>          ))}                    {/* Главная монета */}          <div className="relative mb-6">            <button              onClick={handleCoinClick}              disabled={isBlocked}              className={`relative w-64 h-64 rounded-full bg-gradient-to-br ${getCurrentCoinColor()} shadow-2xl transform transition-all duration-150 border-4 border-yellow-300 hover:border-yellow-200 ${                isBlocked ? 'opacity-50 cursor-not-allowed' : 'hover:shadow-yellow-400/50 active:scale-95'              }`}              style={{ transform: `scale(${coinScale})` }}            >              <div className="absolute inset-0 rounded-full bg-gradient-to-t from-transparent to-white/30"></div>              <div className="text-8xl absolute inset-0 flex items-center justify-center">                {selectedNose}              </div>              <div className="absolute inset-0 rounded-full animate-spin-slow border-2 border-dashed border-yellow-300/40"></div>              <div className="absolute inset-4 rounded-full animate-pulse bg-gradient-to-br from-yellow-300/20 to-transparent"></div>            </button>          </div>          {/* Доступные бустеры */}          {availableBoosters.length > 0 && (            <div className="mb-4">              <h3 className="text-sm font-semibold text-center mb-2 text-green-400">Готовые бустеры:</h3>              <div className="flex justify-center space-x-2">                {availableBoosters.map(booster => (                  <button                    key={booster.id}                    onClick={() => activateBooster(booster.id)}                    className="bg-gradient-to-r from-green-600 to-green-500 text-white px-3 py-2 rounded-lg text-sm font-semibold hover:from-green-500 hover:to-green-400 transition-all"                  >                    {booster.icon} {booster.name}                  </button>                ))}              </div>            </div>          )}          {/* Кнопки быстрого доступа */}          <div className="grid grid-cols-2 gap-4 mb-6 w-full max-w-xs">            <button              onClick={() => setShowRouletteModal(true)}              className={`py-3 px-4 rounded-lg font-semibold transition-all ${                canSpin()                   ? 'bg-gradient-to-r from-purple-600 to-purple-500 text-white hover:from-purple-500 hover:to-purple-400'                   : 'bg-gray-600 text-gray-400 cursor-pointer'              }`}            >              ?? Рулетка              {!canSpin() && (                <div className="text-xs mt-1">{getTimeUntilNextSpin()}</div>              )}            </button>            <button              onClick={() => setShowLeaderboard(true)}              className="bg-gradient-to-r from-blue-600 to-blue-500 text-white py-3 px-4 rounded-lg font-semibold hover:from-blue-500 hover:to-blue-400 transition-all"            >              ?? Рейтинг            </button>          </div>          {/* Статистика */}          <div className="grid grid-cols-2 md:grid-cols-4 gap-3 text-center w-full max-w-2xl">            <div className="bg-gradient-to-br from-gray-800 to-gray-900 p-3 rounded-xl border border-gray-700">              <div className="text-yellow-400 font-bold">{totalClicks.toLocaleString()}</div>              <div className="text-xs text-gray-400">{declension(totalClicks, 'Клик', 'Клика', 'Кликов')}</div>            </div>            <div className="bg-gradient-to-br from-gray-800 to-gray-900 p-3 rounded-xl border border-gray-700">              <div className="text-green-400 font-bold">{(autoClickers * multiplier).toLocaleString()}/с</div>              <div className="text-xs text-gray-400">Авто</div>            </div>            <div className="bg-gradient-to-br from-gray-800 to-gray-900 p-3 rounded-xl border border-gray-700">              <div className="text-red-400 font-bold">{gameStats.criticalHits || 0}</div>              <div className="text-xs text-gray-400">{declension(gameStats.criticalHits || 0, 'Крит', 'Крита', 'Критов')}</div>            </div>            <div className="bg-gradient-to-br from-gray-800 to-gray-900 p-3 rounded-xl border border-gray-700">              <div className="text-blue-400 font-bold">{achievements.length}/{achievementsList.length}</div>              <div className="text-xs text-gray-400">Награды</div>            </div>          </div>        </div>      )}      {/* Магазин */}      {activeTab === 'shop' && (        <div className="flex-1 p-4 overflow-y-auto">          <h2 className="text-xl font-bold mb-4 text-center text-yellow-400">?? Магазин</h2>                    {/* Улучшения */}          <div className="mb-6">            <h3 className="text-lg font-semibold mb-3 text-white">?? Улучшения</h3>            <div className="space-y-3">              {upgrades.map(upgrade => {                const cost = getUpgradeCost(upgrade);                const canAfford = coins >= cost;                                return (                  <div key={upgrade.id} className="bg-gradient-to-r from-gray-800 to-gray-900 p-4 rounded-xl border border-gray-700">                    <div className="flex items-center justify-between">                      <div className="flex items-center space-x-3">                        <div className="text-2xl">{upgrade.icon}</div>                        <div>                          <div className="font-semibold text-white">{upgrade.name}</div>                          <div className="text-sm text-gray-400">{upgrade.description}</div>                          <div className="text-xs text-yellow-400">Уровень: {upgrade.currentLevel}</div>                        </div>                      </div>                      <button                        onClick={() => buyUpgrade(upgrade)}                        disabled={!canAfford}                        className={`px-4 py-2 rounded-lg font-semibold transition-all ${                          canAfford                             ? 'bg-gradient-to-r from-yellow-600 to-yellow-500 hover:from-yellow-500 hover:to-yellow-400 text-black'                             : 'bg-gray-600 text-gray-400 cursor-not-allowed'                        }`}                      >                        {cost > 999999999 ? '?' : cost.toLocaleString()}                      </button>                    </div>                  </div>                );              })}            </div>          </div>                    {/* Бустеры */}          <div className="mb-6">            <h3 className="text-lg font-semibold mb-3 text-white">? Бустеры</h3>            <div className="grid grid-cols-1 gap-3">              {getBoosters().map(booster => {                const canAfford = coins >= booster.cost;                                return (                  <div key={booster.id} className="bg-gradient-to-r from-gray-800 to-gray-900 p-4 rounded-xl border border-gray-700">                    <div className="flex items-center justify-between">                      <div className="flex items-center space-x-3">                        <div className="text-2xl">{booster.icon}</div>                        <div>                          <div className="font-semibold text-white">{booster.name}</div>                          <div className="text-sm text-gray-400">x{booster.effect} на {booster.duration}с</div>                        </div>                      </div>                      <button                        onClick={() => buyBooster(booster.id)}                        disabled={!canAfford}                        className={`px-4 py-2 rounded-lg font-semibold transition-all ${                          canAfford                             ? 'bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white'                             : 'bg-gray-600 text-gray-400 cursor-not-allowed'                        }`}                      >                        {booster.cost.toLocaleString()}                      </button>                    </div>                  </div>                );              })}            </div>          </div>          {/* Магазин гемов */}          <div className="mb-6">            <h3 className="text-lg font-semibold mb-3 text-purple-400">?? Магазин гемов</h3>            <div className="grid grid-cols-1 gap-3">              {gemShop.map(item => {                const canAfford = gems >= item.cost;                                return (                  <div key={item.id} className="bg-gradient-to-r from-purple-900/30 to-purple-800/30 p-4 rounded-xl border border-purple-600/50">                    <div className="flex items-center justify-between">                      <div className="flex items-center space-x-3">                        <div className="text-2xl">{item.icon}</div>                        <div>                          <div className="font-semibold text-white">{item.name}</div>                          <div className="text-sm text-gray-400">{item.description}</div>                        </div>                      </div>                      <button                        onClick={() => buyGemItem(item.id)}                        disabled={!canAfford}                        className={`px-4 py-2 rounded-lg font-semibold transition-all ${                          canAfford                             ? 'bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-500 hover:to-purple-400 text-white'                             : 'bg-gray-600 text-gray-400 cursor-not-allowed'                        }`}                      >                        ??{item.cost}                      </button>                    </div>                  </div>                );              })}            </div>          </div>        </div>      )}      {/* Коллекция */}      {activeTab === 'collection' && (        <div className="flex-1 p-4 overflow-y-auto">          <h2 className="text-xl font-bold mb-4 text-center text-yellow-400">?? Коллекция монет</h2>          <div className="grid grid-cols-2 gap-4">            {noseCollection.map(nose => {              const isUnlocked = unlockedNoses.includes(nose.id);              const isSelected = selectedNose === nose.id;              const canAfford = coins >= nose.cost;                            return (                <div                   key={nose.id}                   className={`p-4 rounded-xl border-2 transition-all ${                    isSelected                       ? 'border-yellow-400 bg-yellow-900/20'                       : isUnlocked                         ? 'border-gray-600 bg-gray-800/50'                         : 'border-gray-700 bg-gray-900/50'                  }`}                >                  <div className="text-center">                    <div className={`w-16 h-16 mx-auto mb-2 rounded-full bg-gradient-to-br ${nose.coinColor} flex items-center justify-center text-2xl ${!isUnlocked ? 'grayscale opacity-50' : ''}`}>                      {nose.id}                    </div>                    <div className={`font-semibold mb-1 ${                      nose.rarity === 'legendary' ? 'text-yellow-400' :                      nose.rarity === 'epic' ? 'text-purple-400' :                      nose.rarity === 'rare' ? 'text-blue-400' : 'text-gray-300'                    }`}>                      {nose.name}                    </div>                    <div className="text-xs text-gray-400 mb-2">                      {nose.bonus > 0 ? `+${(nose.bonus * 100).toFixed(0)}% урон` : 'Базовая'}                    </div>                                        {!isUnlocked && nose.cost > 0 ? (                      <button                        onClick={() => buyNose(nose.id)}                        disabled={!canAfford}                        className={`w-full px-3 py-2 rounded-lg text-sm font-semibold transition-all ${                          canAfford                             ? 'bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-white'                             : 'bg-gray-600 text-gray-400 cursor-not-allowed'                        }`}                      >                        {nose.cost.toLocaleString()}                      </button>                    ) : isUnlocked ? (                      <button                        onClick={() => setSelectedNose(nose.id)}                        className={`w-full px-3 py-2 rounded-lg text-sm font-semibold transition-all ${                          isSelected                             ? 'bg-yellow-600 text-black cursor-default'                             : 'bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white'                        }`}                      >                        {isSelected ? 'Выбрана' : 'Выбрать'}                      </button>                    ) : (                      <div className="text-xs text-green-400">Бесплатно</div>                    )}                  </div>                </div>              );            })}          </div>        </div>      )}      {/* Достижения */}      {activeTab === 'achievements' && (        <div className="flex-1 p-4 overflow-y-auto">          <h2 className="text-xl font-bold mb-4 text-center text-yellow-400">            ?? Достижения ({achievements.length}/{achievementsList.length})          </h2>          <div className="space-y-3">            {achievementsList.map(achievement => {              const isUnlocked = achievements.includes(achievement.id);                            return (                <div                   key={achievement.id}                   className={`p-4 rounded-xl border transition-all ${                    isUnlocked                       ? 'bg-gradient-to-r from-yellow-900/40 to-yellow-800/40 border-yellow-600'                       : 'bg-gradient-to-r from-gray-800 to-gray-900 border-gray-700'                  }`}                >                  <div className="flex items-center justify-between">                    <div className="flex items-center space-x-3">                      <div className={`text-2xl ${isUnlocked ? '' : 'grayscale opacity-50'}`}>                        {achievement.icon}                      </div>                      <div>                        <div className={`font-semibold ${isUnlocked ? 'text-yellow-400' : 'text-gray-400'}`}>                          {achievement.name}                        </div>                        <div className="text-sm text-gray-500">{achievement.desc}</div>                        <div className="text-xs text-purple-400">                          Награда: {achievement.reward.gems}??                          {achievement.reward.nose && ` + ${achievement.reward.nose}`}                        </div>                      </div>                    </div>                    {isUnlocked && (                      <div className="text-green-400 text-xl">?</div>                    )}                  </div>                </div>              );            })}          </div>        </div>      )}      {/* Навигация */}      <div className="bg-gradient-to-r from-gray-800 to-gray-900 border-t border-gray-700">        <div className="flex justify-around py-2">          {[            { id: 'game', icon: '??', name: 'Игра' },            { id: 'shop', icon: '??', name: 'Магазин' },            { id: 'collection', icon: '??', name: 'Монеты' },            { id: 'achievements', icon: '??', name: 'Награды' }          ].map(tab => (            <button              key={tab.id}              onClick={() => setActiveTab(tab.id)}              className={`flex flex-col items-center py-2 px-3 transition-all rounded-lg ${                activeTab === tab.id                   ? 'text-yellow-400 bg-yellow-400/10'                   : 'text-gray-400 hover:text-white hover:bg-gray-700/50'              }`}            >              <div className="text-xl mb-1">{tab.icon}</div>              <div className="text-xs font-medium">{tab.name}</div>            </button>          ))}        </div>      </div>      <style jsx>{`        @keyframes float-up {          0% {            opacity: 1;            transform: translateY(0) scale(1);          }          100% {            opacity: 0;            transform: translateY(-60px) scale(0.8);          }        }                @keyframes spin-slow {          from {            transform: rotate(0deg);          }          to {            transform: rotate(360deg);          }        }                .animate-spin-slow {          animation: spin-slow 15s linear infinite;        }      `}</style>    </div>  );};export default NoseCoinClicker;